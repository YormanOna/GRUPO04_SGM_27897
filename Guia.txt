\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{geometry}
\geometry{margin=2.5cm}
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=cyan,
  pdftitle={Guía de Instalación - Sistema de Gestión Médica Hospitalaria},
  pdfauthor={}
}

\usepackage{tocloft}
\setlength{\cftbeforesecskip}{6pt}
\setlength{\cftbeforesubsecskip}{3pt}

% Configuración para mostrar comandos/bloques de código
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{gray!10},
    frame=single,
    rulecolor=\color{gray!50},
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange},
    columns=fullflexible,
    keepspaces=true,
    showstringspaces=false,
}

% Comando para destacar notas importantes
\usepackage{tcolorbox}
\tcbset{
  note-style/.style={
    colback=yellow!10!white,
    colframe=yellow!60!black,
    sharp corners,
    boxrule=1pt,
    left=1em, right=1em, top=0.8em, bottom=0.8em,
    fonttitle=\bfseries,
    fontupper=\normalfont,
    title after break,
  }
}

\title{\Huge Guía de Instalación \\ \Large Sistema de Gestión Médica Hospitalaria}
\author{Grupo 04}
\date{\small \today}

\begin{document}

\maketitle
\thispagestyle{empty}

\begin{center}
\rule{\linewidth}{1.5pt}
\end{center}

\tableofcontents
\thispagestyle{empty}

\newpage

\section{Introducción}
Esta guía detalla los pasos necesarios para instalar y configurar el \textbf{Sistema de Gestión Médica Hospitalaria}. Se ofrecen dos métodos principales:

\begin{itemize}
    \item \textbf{Instalación Local (Modo Desarrollo):} Instalación manual y personalizada ideal para entornos de desarrollo.
    \item \textbf{Instalación con Docker (Recomendado para Producción):} Instalación automatizada que facilita el despliegue en entornos estables y reproducibles.
\end{itemize}

Siga el procedimiento adecuado según su entorno.

\section{Instalación Local (Modo Desarrollo)}

\subsection{Paso 1: Requisitos Previos}
Asegúrese de tener instaladas las siguientes herramientas:

\begin{itemize}
    \item \href{https://www.python.org/downloads/}{Python 3.10 o superior}
    \item \href{https://nodejs.org/}{Node.js 18 o superior (incluye npm)}
    \item \href{https://dev.mysql.com/downloads/mysql/}{MySQL 8.0 o superior} \textbf{o bien, puede instalar} \href{https://www.apachefriends.org/es/index.html}{XAMPP}, que incluye MySQL y un panel sencillo para administrar la base de datos.
    \item \href{https://git-scm.com/downloads}{Git}
\end{itemize}

\vspace{0.5em}
\textbf{Nota:} Verifique las versiones ejecutando en terminal los comandos \texttt{python --version}, \texttt{node --version}, \texttt{mysql --version}. Con XAMPP, basta con iniciar los servicios desde el panel de control.

\begin{tcolorbox}[note-style,title=Alternativa MySQL/XAMPP:]
Si desea evitar la configuración por línea de comandos, puede usar \textbf{XAMPP} para administrar MySQL fácilmente. Solo inicie los servicios \texttt{Apache} y \texttt{MySQL} desde el panel de XAMPP, luego acceda a \url{http://localhost/phpmyadmin} desde su navegador. Allí podrá crear la base de datos y usuario de forma gráfica.
\end{tcolorbox}

\subsection{Paso 2: Clonar el Repositorio}
Abra una terminal y ejecute:

\begin{lstlisting}[language=bash]
git clone https://github.com/YormanOna/GRUPO04_SGM_27897.git
cd GRUPO04_SGM_27897
\end{lstlisting}

\subsection{Paso 3: Configuración de la Base de Datos MySQL/XAMPP}

\textbf{Opción A: Usando MySQL vía terminal}

Inicie sesión en MySQL y cree la base de datos y usuario:

\begin{lstlisting}[language=bash]
mysql -u root -p
CREATE DATABASE GestionMedicaDB;
CREATE USER 'hospital_user'@'localhost' IDENTIFIED BY 'hospital_pass';
GRANT ALL PRIVILEGES ON GestionMedicaDB.* TO 'hospital_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
\end{lstlisting}

\textbf{Opción B: Usando XAMPP y phpMyAdmin}

\begin{enumerate}
    \item Inicie los servicios \texttt{Apache} y \texttt{MySQL} desde el panel de XAMPP.
    \item Abra su navegador y diríjase a \url{http://localhost/phpmyadmin}.
    \item Cree la base de datos \texttt{GestionMedicaDB} mediante el menú de phpMyAdmin.
    \item En la pestaña de \texttt{Privilegios} agregue un usuario \texttt{hospital\_user} y asigne la contraseña \texttt{hospital\_pass}, otorgando todos los permisos a la nueva base de datos.
\end{enumerate}

(Optional) Para cargar datos de ejemplo:

\begin{lstlisting}[language=bash]
mysql -u hospital_user -p GestionMedicaDB < DB/InsertDatos.sql
\end{lstlisting}

\subsection{Paso 4: Configurar el Backend (Python / FastAPI)}

\subsubsection*{Crear y activar entorno virtual e instalar dependencias}

\textbf{Linux / Mac:}
\begin{lstlisting}[language=bash]
cd Backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
\end{lstlisting}

\textbf{Windows:}
\begin{lstlisting}[language=bash]
cd Backend
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
\end{lstlisting}

\subsubsection*{Configurar variables de entorno}

Cree el archivo \texttt{.env} en la carpeta \texttt{Backend/} con el siguiente contenido:

\begin{lstlisting}[language=]
DB_USER=hospital_user
DB_PASSWORD=hospital_pass
DB_HOST=localhost
DB_PORT=3306
DB_NAME=GestionMedicaDB

SECRET_KEY=tu_clave_secreta_muy_segura_cambiar_en_produccion
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=43200
\end{lstlisting}

\begin{tcolorbox}[note-style,title=Importante:]
Reemplace \texttt{DB\_PASSWORD} y \texttt{SECRET\_KEY} por valores seguros antes de usar en producción.
\end{tcolorbox}

\subsection{Paso 5: Configurar el Frontend (React/Vite)}

\begin{lstlisting}[language=bash]
cd ../Frontend
npm install
\end{lstlisting}

Cree un archivo \texttt{.env} en la carpeta \texttt{Frontend/} con:

\begin{lstlisting}[language=]
VITE_API_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000/ws
\end{lstlisting}

\subsection{Paso 6: Iniciar el Sistema}

\textbf{En dos terminales separadas, ejecute:}

\textbf{Terminal 1 - Backend:}
\begin{lstlisting}[language=bash]
cd Backend
source venv/bin/activate  # O venv\Scripts\activate en Windows
uvicorn app.main:app --reload
\end{lstlisting}

\textbf{Terminal 2 - Frontend:}
\begin{lstlisting}[language=bash]
cd Frontend
npm run dev
\end{lstlisting}

El sistema estará disponible en \url{http://localhost:5173}.

\subsection{Acceso y Usuarios Predeterminados}

\begin{tabular}{p{4cm} p{8cm}}
\hline
\textbf{Rol} & \textbf{Email / Contraseña} \\
\hline
Super Administrador & superadmin@hospital.com / superadmin123 \\
Administrador & admin@hospital.com / admin123 \\
Médico & medico@hospital.com / medico123 \\
Enfermera & enfermera@hospital.com / enfer123 \\
Farmacéutico & farmacia@hospital.com / farma123 \\
\hline
\end{tabular}

\vspace{1em}

\section{Instalación con Docker (Recomendada para Producción)}

\subsection{Paso 1: Requisitos Previos}
Instale:

\begin{itemize}
    \item \href{https://www.docker.com/products/docker-desktop}{Docker Desktop}
    \item \href{https://git-scm.com/downloads}{Git}
\end{itemize}

\subsection{Paso 2: Clonar el repositorio}

\begin{lstlisting}[language=bash]
git clone https://github.com/YormanOna/GRUPO04_SGM_27897.git
cd GRUPO04_SGM_27897
\end{lstlisting}

\subsection{Paso 3: Desplegar los contenedores}

\begin{lstlisting}[language=bash]
cd "Docker Compose"
docker-compose up -d
\end{lstlisting}

Este comando levantará 3 contenedores: MySQL, Backend (FastAPI) y Frontend (React).

\subsection{Paso 4: Acceder al sistema}

\begin{itemize}
    \item Frontend (Aplicación Web): \url{http://localhost:5173}
    \item Backend API: \url{http://localhost:8000}
    \item Documentación Swagger: \url{http://localhost:8000/docs}
    \item MySQL (cliente externo): \\
          Host: localhost \\
          Puerto: 3307 \\
          Usuario: hospital_user \\
          Contraseña: hospital_pass
\end{itemize}

\subsection{Comandos útiles de Docker}

\begin{lstlisting}[language=bash]
docker-compose logs -f          # Ver logs en tiempo real
docker-compose ps              # Ver estado de contenedores
docker-compose restart          # Reiniciar contenedores
docker-compose down            # Detener y eliminar contenedores
docker-compose down -v          # Eliminar volúmenes (bdd)
docker-compose up -d --build    # Reconstruir imágenes
docker stats                   # Ver uso de recursos
\end{lstlisting}

\begin{tcolorbox}[note-style,title=Notas Finales]
\begin{itemize}
  \item Los usuarios por defecto se crean automáticamente la primera vez que se levanta el sistema. Es recomendable cambiar las contraseñas en producción.
  \item Para mejorar el rendimiento en producción, utilice el archivo \texttt{docker-compose.prod.yml}, que incluye Nginx, Gunicorn con múltiples workers y configuraciones optimizadas de MySQL.
\end{itemize}
\end{tcolorbox}

\end{document}
